name: CI

on:
  push:
    branches:
      - main
    paths-ignore:
      - 'README.md'
      - .gitignore
      - 'helm/**'
      - 'k8s/**'

jobs:
  build:
   runs-on: ubuntu-latest
  
   steps:
   - name: Checkout repository
     uses: actions/checkout@v4

   - name: Set up Go 1.22
     uses: actions/setup-go@v2
     with:
       go-version: 1.22

   - name: Build
     uses: go build -o go-web-app
     
   - name: Test
     uses: go test ./...

  code-quality:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Run golangci-lint
      uses: golangci/golangci-lint-action@v6
      with:
        version: v1.56.2

push:
  runs-on: ubuntu-latest

  needs: build

  steps:
  - name: Checkout repository
    uses: actions/checkout@v4

  - name: Set up Docker buildx
    uses: docker/setup-buildx-action/v1

  - name: Login to DockerHub
    uses: docker/login-action@v3
    with:
      username: ${{ secrets.DOCKERHUB_USERNAME }}
      password: ${{ secrets.DOCKERHUB_TOKEN }}

  - name: Build and push action
    uses: docker/build-push-action/v6
    with:
      context: .
      file: ./Dockerfile
      push: true
      tags: ${{ secrets.DOCKERHUB_USERNAME }}/go-weg-app:${{github.run_id}}






        
